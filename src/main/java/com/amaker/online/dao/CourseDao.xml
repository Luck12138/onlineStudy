<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://10.20.91.130/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.amaker.online.dao.CourseDao">


    <sql id="All_Columns">
        name, type, classify, classify_name, sub_classify, sub_classify_name, direction, username,
        level, free, price, time, onsale, brief, picture,
        recommend, weight, study_count, create_time, create_user, update_time,
        update_user, del, id
    </sql>

    <select id="getTotalItemsCount" parameterType="com.amaker.online.model.Course" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_course
        <trim prefix="WHERE " prefixOverrides="AND |OR ">
            AND del = 0
            <if test="type != null">
                AND type = #{type, jdbcType=INTEGER}
            </if>
            <if test="classify != null">
                AND classify = #{classify, jdbcType=INTEGER}
            </if>
            <if test="subClassify != null">
                AND sub_classify = #{subClassify, jdbcType=INTEGER}
            </if>
            <if test="onsale != null">
                AND onsale = #{onsale, jdbcType=INTEGER}
            </if>
            <if test="name != null">
                AND name like CONCAT('%',#{name},'%' )
            </if>
        </trim>
    </select>

    <select id="selectCoursePage" resultType="com.amaker.online.model.Course">
        SELECT
        <include refid="All_Columns"/>
        FROM t_course
      <where>
        <if test="param1.type != null">
             type = #{param1.type, jdbcType=INTEGER}
            </if>
            <if test="param1.classify != null">
                AND classify = #{param1.classify, jdbcType=INTEGER}
            </if>
            <if test="param1.subClassify != null">
                AND sub_classify = #{param1.subClassify, jdbcType=INTEGER}
            </if>
            <if test="param1.onsale != null">
                AND onsale = #{param1.onsale, jdbcType=INTEGER}
            </if>
            <if test="param1.name != null">
                AND name like CONCAT('%',#{param1.name},'%' )
            </if>
      </where>

            <if test="param2.sortField != null and param2.sortField != '' ">
                ORDER BY ${param2.sortField} ${param2.sortDirection}
            </if>

            LIMIT #{param2.startIndex, jdbcType=INTEGER} , #{param2.pageSize, jdbcType=INTEGER}

    </select>

    <select id="queryCourseByTo" parameterType="com.amaker.online.model.CourseQueryDto" resultType="com.amaker.online.model.Course">
       SELECT
        <include refid="All_Columns"/>
        From t_course
        <trim prefix="WHERE " prefixOverrides="AND |OR ">
            <if test="type != null">
                AND type = #{type, jdbcType=INTEGER}
            </if>
            <if test="classify != null">
                AND classify = #{classify, jdbcType=INTEGER}
            </if>
            <if test="subClassify != null">
                AND sub_classify = #{subClassify, jdbcType=INTEGER}
            </if>
            <if test="direction != null">
                AND direction = #{direction, jdbcType=INTEGER}
            </if>
            <if test="username != null">
                AND username = #{username, jdbcType=INTEGER}
            </if>
            <if test="free != null">
                AND free = #{free, jdbcType=INTEGER}
            </if>
            <if test="onsale != null">
                AND onsale = #{onsale, jdbcType=INTEGER}
            </if>
        </trim>
        <if test="sortField != null">
            ORDER BY ${sortField}  ${sortDirection}
        </if>
        <if test="start != null and end != null">
            LIMIT #{start, jdbcType=INTEGER} , #{end, jdbcType=INTEGER}
        </if>
    </select>
</mapper>